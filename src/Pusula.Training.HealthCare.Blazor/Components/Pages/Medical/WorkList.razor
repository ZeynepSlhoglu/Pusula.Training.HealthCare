@page "/doctor/work-list"

@using Pusula.Training.HealthCare.Protocols
@using Syncfusion.Blazor.Grids
@using Syncfusion.Blazor.DataForm
@using Syncfusion.Blazor.Buttons
@inherits HealthCareComponentBase

@inject IProtocolAppService ProtocolAppService

<div class="bg-white mb-3">
    <SfDataForm Model="@DoctorWorkListInput" OnValidSubmit="@SearchAsync"
                ButtonsAlignment="FormButtonsAlignment.Stretch"
                ValidationDisplayMode="FormValidationDisplay.Tooltip">
        <FormValidator>
            <DataAnnotationsValidator/>
        </FormValidator>
        <FormTemplate>
            <div class="d-flex gap-2 p-2 align-items-end">
                <SfDateRangePicker TValue="DateTime" @bind-StartDate="@DoctorWorkListInput.StartTime"
                                   @bind-EndDate="@DoctorWorkListInput.EndTime" FullScreen Format="dd.MM.yyyy"
                                   FirstDayOfWeek="@((int)DayOfWeek.Monday)">
                    <DateRangePickerEvents TValue="DateTime" ValueChange="@SearchAsync"></DateRangePickerEvents>
                    <DateRangePickerPresets>
                        <DateRangePickerPreset Label="@L["Today"]" Start="@_today" End="@_tomorrow"/>
                        <DateRangePickerPreset Label="@L["ThisWeek"]" Start="@_thisWeekStart"
                                               End="@_thisWeekStart.AddDays(6)"/>
                        <DateRangePickerPreset Label="@L["ThisMonth"]" Start="@_thisMonthStart"
                                               End="@_thisMonthStart.AddMonths(1).AddDays(-1)"/>
                        <DateRangePickerPreset Label="@L["OneMonth"]" Start="@_today.AddMonths(-1)"
                                               End="@_today"/>
                        <DateRangePickerPreset Label="@L["ThreeMonth"]" Start="@_today.AddMonths(-3)"
                                               End="@_today"/>
                        <DateRangePickerPreset Label="@L["SixMonth"]" Start="@_today.AddMonths(-6)"
                                               End="@_today"/>
                        <DateRangePickerPreset Label="@L["OneYear"]" Start="@_today.AddYears(-1)"
                                               End="@_today"/>
                    </DateRangePickerPresets>
                </SfDateRangePicker>

                <SfButton type="submit" IsPrimary>@L["Filter"]</SfButton>
            </div>
        </FormTemplate>
        <FormButtons></FormButtons>
    </SfDataForm>
</div>

<SfGrid TValue="ProtocolDto" Height="100%" Width="100%" DataSource="@DoctorWorkList" EnableHover EnableStickyHeader AllowPaging="false"
        EnableVirtualMaskRow>
    <GridColumns>
        <GridColumn HeaderText="@L["Gender"]" AutoFit>
            <Template>
                @{
                    var dto = (context as ProtocolDto)!;
                    <PatientGenderIcon Gender="@dto.Patient.Gender" />
                }
            </Template>
        </GridColumn>
        <GridColumn HeaderText="@L["PatientNo"]" AutoFit>
            <Template>
                @{
                    var dto = (context as ProtocolDto)!;
                    @dto.Patient.No
                }
            </Template>
        </GridColumn>
        <GridColumn HeaderText="@L["Patient"]" >
            <Template>
                @{
                    var dto = (context as ProtocolDto)!;
                    <span>@dto.Patient.FullName (@dto.Patient.BirthDate.ToString("dd.MM.yyyy") | @dto.Patient.Age.Item1 @dto.Patient.Age.Item2) </span>
                }
            </Template>
        </GridColumn>
        <GridColumn HeaderText="@L["ProtocolTypeAction"]" AutoFit>
            <Template>
                @{
                    var dto = (context as ProtocolDto)!;
                    @(dto.ProtocolTypeAction.Name)
                }
            </Template>
        </GridColumn>
        <GridColumn HeaderText="@L["Status"]" AutoFit>
            <Template>
                @{
                    var dto = (context as ProtocolDto)!;
                    <ProtocolStatusBadge Status="@dto.Status"/>
                }
            </Template>
        </GridColumn>
        <GridColumn HeaderText="@L["StartDate"]" AutoFit>
            <Template>
                @{
                    var dto = (context as ProtocolDto)!;
                    @dto.StartTime.ToString("dd.MM.yyyy hh:mm")
                }
            </Template>
        </GridColumn>
    </GridColumns>
</SfGrid>
